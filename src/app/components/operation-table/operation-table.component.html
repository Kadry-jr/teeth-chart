<div class="operation-table-container">
  <h2>Operation Plan</h2>
  
  <table mat-table [dataSource]="operations" class="mat-elevation-z2 operations-table">
    <!-- Operation Description Column -->
    <ng-container matColumnDef="description">
      <th mat-header-cell *matHeaderCellDef>Operation</th>
      <td mat-cell *matCellDef="let operation">
        <div class="operation-title">{{ operation.title }}</div>
        <div class="operation-code">{{ operation.code }}</div>
      </td>
    </ng-container>
    <!-- Teeth Column -->
    <ng-container matColumnDef="teeth">
      <th mat-header-cell *matHeaderCellDef>Teeth</th>
      <td mat-cell *matCellDef="let operation">
        <span *ngIf="operation.teethNumbers?.length === 32">All</span>
        <span *ngIf="operation.teethNumbers?.length !== 32">
          {{ formatTeethNumbers(operation.teethNumbers) }}
        </span>
      </td>
    </ng-container>

    <!-- Priority Column -->
    <ng-container matColumnDef="priority">
      <th mat-header-cell *matHeaderCellDef>Priority</th>
      <td mat-cell *matCellDef="let operation">
        <div class="priority-indicator" [ngClass]="'priority-' + operation.priority">
          {{ operation.priority }}
        </div>
      </td>
    </ng-container>

    <!-- Dentist Column -->
    <ng-container matColumnDef="dentist">
      <th mat-header-cell *matHeaderCellDef>Dentist</th>
      <td mat-cell *matCellDef="let operation">
        {{ getDentistName(operation.dentistId) }}
      </td>
    </ng-container>

    <!-- Planned Date Column -->
    <ng-container matColumnDef="plannedDate">
      <th mat-header-cell *matHeaderCellDef>Planned Date</th>
      <td mat-cell *matCellDef="let operation">
        {{ operation.plannedStartDate | date:'mediumDate' }}
      </td>
    </ng-container>

    <!-- Start Date Column -->
    <ng-container matColumnDef="startDate">
      <th mat-header-cell *matHeaderCellDef>Start Date</th>
      <td mat-cell *matCellDef="let operation">
        {{ operation.actualStartDate ? (operation.actualStartDate | date:'mediumDate') : 'Not started' }}
      </td>
    </ng-container>

    <!-- Notes Column -->
    <ng-container matColumnDef="notes">
      <th mat-header-cell *matHeaderCellDef>Notes</th>
      <td mat-cell *matCellDef="let operation" class="notes-cell">
        <div class="notes-content">{{ operation.notes }}</div>
      </td>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let operation">
        <span class="status-badge" [ngClass]="'status-' + operation.status.toLowerCase().replace(' ', '-')">
          {{ operation.status }}
        </span>
      </td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let operation">
        <button mat-icon-button [matMenuTriggerFor]="actionMenu" class="action-button">
          <mat-icon>...</mat-icon>
        </button>
        <mat-menu #actionMenu="matMenu">
          <button mat-menu-item (click)="editOperation(operation)">
            <mat-icon>edit</mat-icon>
            <span>Edit</span>
          </button>
          <button mat-menu-item (click)="deleteOperation(operation)">
            <mat-icon>delete</mat-icon>
            <span>Delete</span>
          </button>
        </mat-menu>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
  
  <div *ngIf="operations.length === 0" class="no-operations">
    <p>No operations planned for this patient.</p>
    <p>Select teeth and click "ADD OPERATION" to create a new operation.</p>
  </div>
</div>